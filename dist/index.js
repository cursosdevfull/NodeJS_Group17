"use strict";var __awaiter=this&&this.__awaiter||function(r,t,e,o){return new(e||(e=Promise))((function(a,s){function i(r){try{p(o.next(r))}catch(r){s(r)}}function n(r){try{p(o.throw(r))}catch(r){s(r)}}function p(r){var t;r.done?a(r.value):(t=r.value,t instanceof e?t:new e((function(r){r(t)}))).then(i,n)}p((o=o.apply(r,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0}),require("reflect-metadata");const dotenv_1=__importDefault(require("dotenv")),app_1=__importDefault(require("./app")),database_bootstrap_1=require("./bootstrap/database.bootstrap"),redis_bootstrap_1=require("./bootstrap/redis.bootstrap"),server_bootstrap_1=require("./bootstrap/server.bootstrap"),gracefully_1=require("./core/shutdown/gracefully"),logger_1=require("./core/utils/logger");dotenv_1.default.config({path:"env-variables.txt"});const serverBootstrap=new server_bootstrap_1.ServerBootstrap(app_1.default),databaseBootstrap=new database_bootstrap_1.DatabaseBootstrap,redisBootstrap=new redis_bootstrap_1.RedisBootstrap,serversBootstrap=[serverBootstrap,databaseBootstrap,redisBootstrap],logger=logger_1.Logger.createLogger();__awaiter(void 0,void 0,void 0,(function*(){try{const r=[serverBootstrap.initialize(),databaseBootstrap.initialize(),redisBootstrap.initialize()];(yield Promise.all(r)).forEach((r=>logger.logInfo("bootstrap",{parameter:r})))}catch(r){serverBootstrap.close(),logger.logError("Error on server bootstrap",r)}})),process.on("SIGINT",(0,gracefully_1.gracefullyShutdown)("SIGINT",...serversBootstrap)),process.on("SIGTERM",(0,gracefully_1.gracefullyShutdown)("SIGTERM",...serversBootstrap)),process.on("SIGUSR2",(0,gracefully_1.gracefullyShutdown)("SIGUSR2",...serversBootstrap));