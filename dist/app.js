"use strict";var __awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function u(e){try{a(i.next(e))}catch(e){n(e)}}function o(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(u,o)}a((i=i.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const express_1=__importDefault(require("express")),query_cache_1=require("./core/cache/query.cache"),response_interceptor_1=require("./core/interceptors/response.interceptor"),status_1=require("./core/status/status"),auth_routes_1=require("./modules/auth/presentation/auth.routes"),role_routes_1=require("./modules/role/presentation/role.routes"),user_routes_1=require("./modules/user/presentation/user.routes");class App{constructor(){this.application=(0,express_1.default)(),this.mountMiddlewares(),this.mountInterceptors(),this.mountHealthCheck(),this.mountRoutes(),this.mountInvalidCache()}mountMiddlewares(){this.application.use(express_1.default.json()),this.application.use(express_1.default.urlencoded({extended:!0}))}mountInterceptors(){this.application.use(response_interceptor_1.ResponseInterceptor)}mountHealthCheck(){this.application.get("/",this.isRunningAll),this.application.get("/health",this.isRunningAll),this.application.get("/healthcheck",this.isRunningAll)}mountRoutes(){this.application.use("/user",user_routes_1.router),this.application.use("/role",role_routes_1.router),this.application.use("/auth",auth_routes_1.router)}mountInvalidCache(){this.application.get("/invalidate-cache",query_cache_1.InvalidationQueryCache.execute())}isRunningAll(e,t){return __awaiter(this,void 0,void 0,(function*(){(yield status_1.Status.isRunningAll())?t.send("I'm alive"):t.status(500).send("I'm not alive")}))}}exports.default=(new App).application;