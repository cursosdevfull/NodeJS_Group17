"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function r(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});const student_application_1=require("../application/student.application"),student_1=require("../domain/student"),student_inmemory_1=require("../infrastructure/in-memory/student.inmemory");class StudentController{constructor(e){this.application=e}getAll(e,t){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.application.getAll();t.json(e)}))}getOne(e,t){return __awaiter(this,void 0,void 0,(function*(){if(isNaN(Number(e.params.id)))return t.status(400).json({message:"Invalid ID"});if(Number(e.params.id)<1)return t.status(400).json({message:"Invalid ID"});const n=yield this.application.getById(Number(e.params.id));t.json(n)}))}getByPage(e,t){return __awaiter(this,void 0,void 0,(function*(){const{page:n,limit:i}=e.query;if(isNaN(Number(n))||isNaN(Number(i)))return t.status(400).json({message:"Invalid page or limit"});if(Number(n)<1||Number(i)<1)return t.status(400).json({message:"Invalid page or limit"});const a=yield this.application.getByPage(Number(n),Number(i));t.json(a)}))}create(e,t){return __awaiter(this,void 0,void 0,(function*(){const{name:n,lastname:i,age:a,email:s,phone:r,address:o,city:u,country:d,gender:l,career:c,semester:m}=e.body;if(!new RegExp(/^([\w.-]+)@(\[(\d{1,3}\.){3}|(?!hotmail|gmail|googlemail|yahoo|gmx|ymail|outlook|bluewin|protonmail|t\-online|web\.|online\.|aol\.|live\.)(([a-zA-Z\d-]+\.)+))([a-zA-Z]{2,63}|\d{1,3})(\]?)$/).test(s))return t.status(400).json({message:"Invalid email"});if(o.length<5)return t.status(400).json({message:"Invalid address"});if(u.length<3)return t.status(400).json({message:"Invalid city"});if(d.length<3)return t.status(400).json({message:"Invalid country"});if(!c.trim().toLowerCase().includes("ingenieria")&&!c.trim().toLowerCase().includes("ing"))return t.status(400).json({message:"Invalid career"});const p={name:n,lastname:i,age:a,email:s,phone:r,address:o,city:u,country:d,gender:l,career:c,semester:m},g=yield this.application.create(new student_1.Student(p));t.json(g)}))}update(e,t){return __awaiter(this,void 0,void 0,(function*(){const n=e.body,i=yield this.application.update(Number(e.params.id),n);t.json(i)}))}delete(e,t){return __awaiter(this,void 0,void 0,(function*(){const n=yield this.application.remove(Number(e.params.id));t.json(n)}))}}exports.default=new StudentController(new student_application_1.StudentApplication(student_inmemory_1.StudentInMemory.getInstance()));