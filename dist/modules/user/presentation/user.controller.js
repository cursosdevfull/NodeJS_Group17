"use strict";var __awaiter=this&&this.__awaiter||function(r,s,t,e){return new(t||(t=Promise))((function(a,o){function i(r){try{d(e.next(r))}catch(r){o(r)}}function n(r){try{d(e.throw(r))}catch(r){o(r)}}function d(r){var s;r.done?a(r.value):(s=r.value,s instanceof t?s:new t((function(r){r(s)}))).then(i,n)}d((e=e.apply(r,s||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserController=void 0;const redis_bootstrap_1=require("../../../bootstrap/redis.bootstrap"),crypt_1=require("../../../core/services/crypt"),user_factory_1=require("../domain/roots/user.factory");class UserController{constructor(r){this.application=r,this.create=this.create.bind(this),this.update=this.update.bind(this),this.delete=this.delete.bind(this),this.getAll=this.getAll.bind(this),this.getById=this.getById.bind(this),this.getByPage=this.getByPage.bind(this)}create(r,s){return __awaiter(this,void 0,void 0,(function*(){const t=r.body,e=Object.assign(Object.assign({},t),{password:yield crypt_1.Crypt.hash(t.password)}),a=user_factory_1.UserFactory.create(e),o=yield this.application.save(a);if(o.isErr())return s.status(o.error.status).json({statusCodeId:o.error.statusCodeId,message:o.error.message,stack:o.error.stack,errorsDetails:o.error.errorsDetails});s.status(201).json({status:"User created"})}))}update(r,s){return __awaiter(this,void 0,void 0,(function*(){const t=r.body,e=r.params.id,a=yield this.application.getById(e);if(a.isErr())return s.status(a.error.status).json({statusCodeId:a.error.statusCodeId,message:a.error.message,stack:a.error.stack,errorsDetails:a.error.errorsDetails});const o=a.value;o.update(t);const i=yield this.application.save(o);if(i.isErr())return s.status(i.error.status).json({statusCodeId:i.error.statusCodeId,message:i.error.message,stack:i.error.stack,errorsDetails:i.error.errorsDetails});s.status(200).json({status:"User updated"})}))}delete(r,s){return __awaiter(this,void 0,void 0,(function*(){const t=r.params.id,e=yield this.application.getById(t);if(e.isErr())return s.status(e.error.status).json({statusCodeId:e.error.statusCodeId,message:e.error.message,stack:e.error.stack,errorsDetails:e.error.errorsDetails});const a=e.value;a.delete();const o=yield this.application.save(a);if(o.isErr())return s.status(o.error.status).json({statusCodeId:o.error.statusCodeId,message:o.error.message,stack:o.error.stack,errorsDetails:o.error.errorsDetails});s.status(200).json({status:"User deleted"})}))}getAll(r,s){return __awaiter(this,void 0,void 0,(function*(){const r=yield this.application.getAll();if(r.isErr())return s.status(r.error.status).json({statusCodeId:r.error.statusCodeId,message:r.error.message,stack:r.error.stack,errorsDetails:r.error.errorsDetails});const t=r.value;s.locals.cacheKey&&(yield redis_bootstrap_1.RedisBootstrap.set(s.locals.cacheKey,JSON.stringify(t))),s.status(200).json(t)}))}getById(r,s){return __awaiter(this,void 0,void 0,(function*(){const t=r.params.id,e=yield this.application.getById(t);if(e.isErr())return s.status(e.error.status).json({statusCodeId:e.error.statusCodeId,message:e.error.message,stack:e.error.stack,errorsDetails:e.error.errorsDetails});const a=e.value;s.locals.cacheKey&&(yield redis_bootstrap_1.RedisBootstrap.set(s.locals.cacheKey,JSON.stringify(a))),s.status(200).json(a)}))}getByPage(r,s){return __awaiter(this,void 0,void 0,(function*(){const t=parseInt(r.query.page),e=parseInt(r.query.limit),a=yield this.application.getByPage(t,e);if(a.isErr())return s.status(a.error.status).json({statusCodeId:a.error.statusCodeId,message:a.error.message,stack:a.error.stack,errorsDetails:a.error.errorsDetails});const o=a.value;s.status(200).json(o)}))}}exports.UserController=UserController;